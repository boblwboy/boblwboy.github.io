<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="spring cloud," />










<meta name="description" content="Spring Boot应用启动流程">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Boot应用启动流程">
<meta property="og:url" content="http://boblwboy.github.io/2019/12/20/spring-boot-cloud-8/index.html">
<meta property="og:site_name" content="Bob's blog">
<meta property="og:description" content="Spring Boot应用启动流程">
<meta property="og:updated_time" content="2019-12-20T08:58:49.174Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Spring Boot应用启动流程">
<meta name="twitter:description" content="Spring Boot应用启动流程">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://boblwboy.github.io/2019/12/20/spring-boot-cloud-8/"/>





  <title>Spring Boot应用启动流程 | Bob's blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Bob's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">WHILE(TRUE) CODING();</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://boblwboy.github.io/2019/12/20/spring-boot-cloud-8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="BOB">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bob's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Spring Boot应用启动流程</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-20T15:07:16+08:00">
                2019-12-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          
              <div class="post-description">
                  Spring Boot应用启动流程
              </div>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <a id="more"></a>
<h2 id="Spring-Boot应用启动流程"><a href="#Spring-Boot应用启动流程" class="headerlink" title="Spring Boot应用启动流程"></a>Spring Boot应用启动流程</h2><p>调用SpringApplication的静态run方法</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">@SpringBootApplication</div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> MyApplication &#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(<span class="keyword">String</span>[] args) &#123;</div><div class="line">        SpringApplication.<span class="built_in">run</span>(MyApplication.<span class="keyword">class</span>, args);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>实际上是new了一个SpringApplication的实例</p>
<p>Create a new SpringApplication instance. The application context will load beans from the specified primary sources (see class-level documentation for details. The instance can be customized before calling run(String…).</p>
<p>创建一个新的SpringApplication实例。应用程序上下文将从指定的主要源加载bean(有关详细信息，请参阅类级文档)。可以在调用run(String…)之前定制实例。</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> SpringApplication &#123;</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> ConfigurableApplicationContext run(<span class="keyword">Class</span>&lt;?&gt; primarySource,</div><div class="line">			String... args) &#123;</div><div class="line">		<span class="keyword">return</span> run(<span class="keyword">new</span> <span class="keyword">Class</span>&lt;?&gt;[] &#123; primarySource &#125;, args);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">  <span class="keyword">public</span> <span class="keyword">static</span> ConfigurableApplicationContext run(<span class="keyword">Class</span>&lt;?&gt;[] primarySources,</div><div class="line">			String[] args) &#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> SpringApplication(primarySources).run(args);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">  <span class="keyword">public</span> SpringApplication(<span class="keyword">Class</span>&lt;?&gt;... primarySources) &#123;</div><div class="line">		<span class="keyword">this</span>(<span class="keyword">null</span>, primarySources);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">  <span class="keyword">public</span> SpringApplication(ResourceLoader resourceLoader, <span class="keyword">Class</span>&lt;?&gt;... primarySources) &#123;</div><div class="line">		<span class="keyword">this</span>.resourceLoader = resourceLoader;</div><div class="line">		Assert.notNull(primarySources, <span class="string">"PrimarySources must not be null"</span>);</div><div class="line">		<span class="keyword">this</span>.primarySources = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(Arrays.<span class="keyword">asList</span>(primarySources));</div><div class="line">		<span class="keyword">this</span>.webApplicationType = WebApplicationType.deduceFromClasspath();</div><div class="line">		setInitializers((Collection) getSpringFactoriesInstances(</div><div class="line">				ApplicationContextInitializer.<span class="keyword">class</span>));</div><div class="line">		setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.<span class="keyword">class</span>));</div><div class="line">		<span class="keyword">this</span>.mainApplicationClass = deduceMainApplicationClass();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>SpringApplication详细构造方法中的代码片段<br>this.webApplicationType = WebApplicationType.deduceFromClasspath();<br>从classpath中来推断出web应用类型</p>
<p>WebApplicationType web应用可能类型的枚举 </p>
<ul>
<li>NONE     应用不应当以一个web应用来运行也不应该启动一个嵌入式的web服务器</li>
<li>SERVLET  应用程序应该作为一个基于servlet的web应用程序运行，并应该启动一个嵌入式servlet web服务器</li>
<li>REACTIVE 应用程序应作为一个反应性web应用程序运行，并应启动一个嵌入式反应性web服务器</li>
</ul>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * An enumeration of possible types of web application.</div><div class="line"> *</div><div class="line"> * @author Andy Wilkinson</div><div class="line"> * @author Brian Clozel</div><div class="line"> * @since 2.0.0</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">enum</span> WebApplicationType &#123;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * The application should not run as a web application and should not start an</div><div class="line">	 * embedded web server.</div><div class="line">	 */</div><div class="line">	NONE,</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * The application should run as a servlet-based web application and should start an</div><div class="line">	 * embedded servlet web server.</div><div class="line">	 */</div><div class="line">	SERVLET,</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * The application should run as a reactive web application and should start an</div><div class="line">	 * embedded reactive web server.</div><div class="line">	 */</div><div class="line">	REACTIVE;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">String</span>[] SERVLET_INDICATOR_CLASSES = &#123; <span class="string">"javax.servlet.Servlet"</span>,</div><div class="line">			<span class="string">"org.springframework.web.context.ConfigurableWebApplicationContext"</span> &#125;;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">String</span> WEBMVC_INDICATOR_CLASS = <span class="string">"org.springframework."</span></div><div class="line">			+ <span class="string">"web.servlet.DispatcherServlet"</span>;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">String</span> WEBFLUX_INDICATOR_CLASS = <span class="string">"org."</span></div><div class="line">			+ <span class="string">"springframework.web.reactive.DispatcherHandler"</span>;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">String</span> JERSEY_INDICATOR_CLASS = <span class="string">"org.glassfish.jersey.servlet.ServletContainer"</span>;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">String</span> SERVLET_APPLICATION_CONTEXT_CLASS = <span class="string">"org.springframework.web.context.WebApplicationContext"</span>;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">String</span> REACTIVE_APPLICATION_CONTEXT_CLASS = <span class="string">"org.springframework.boot.web.reactive.context.ReactiveWebApplicationContext"</span>;</div><div class="line"></div><div class="line">	<span class="keyword">static</span> WebApplicationType deduceFromClasspath() &#123;</div><div class="line">		<span class="keyword">if</span> (ClassUtils.isPresent(WEBFLUX_INDICATOR_CLASS, <span class="keyword">null</span>)</div><div class="line">				&amp;&amp; !ClassUtils.isPresent(WEBMVC_INDICATOR_CLASS, <span class="keyword">null</span>)</div><div class="line">				&amp;&amp; !ClassUtils.isPresent(JERSEY_INDICATOR_CLASS, <span class="keyword">null</span>)) &#123;</div><div class="line">			<span class="keyword">return</span> WebApplicationType.REACTIVE;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">String</span> className : SERVLET_INDICATOR_CLASSES) &#123;</div><div class="line">			<span class="keyword">if</span> (!ClassUtils.isPresent(className, <span class="keyword">null</span>)) &#123;</div><div class="line">				<span class="keyword">return</span> WebApplicationType.NONE;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> WebApplicationType.SERVLET;</div><div class="line">	&#125;</div><div class="line">  ...</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Determine whether the Class identified by the supplied name is present and can be loaded. Will return false if either the class or one of its dependencies is not present or cannot be loaded.<br>确定由提供的名称标识的类是否存在并可以加载。如果类或其依赖项之一不存在或无法加载，则返回false。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassUtils</span> &#123;</span></div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> isPresent(String className, <span class="meta">@Nullable</span> ClassLoader classLoader) &#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			forName(className, classLoader);</div><div class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">catch</span> (IllegalAccessError err) &#123;</div><div class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Readability mismatch in inheritance hierarchy of class ["</span> +</div><div class="line">					className + <span class="string">"]: "</span> + err.getMessage(), err);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">catch</span> (Throwable ex) &#123;</div><div class="line">			<span class="comment">// Typically ClassNotFoundException or NoClassDefFoundError...</span></div><div class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>SpringApplication详细构造方法中的代码片段  </p>
<pre><code>setInitializers((Collection) getSpringFactoriesInstances(
        ApplicationContextInitializer.class));
</code></pre><p>设置初始化器</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> SpringApplication &#123;</div><div class="line"></div><div class="line">  ...</div><div class="line"></div><div class="line">	<span class="keyword">private</span> &lt;T&gt; Collection&lt;T&gt; getSpringFactoriesInstances(Class&lt;T&gt; <span class="class"><span class="keyword">type</span>) &#123;</span></div><div class="line">		<span class="keyword">return</span> getSpringFactoriesInstances(<span class="class"><span class="keyword">type</span>, <span class="title">new</span> <span class="title">Class</span>&lt;?&gt;[] &#123;&#125;);</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> &lt;T&gt; Collection&lt;T&gt; getSpringFactoriesInstances(Class&lt;T&gt; <span class="class"><span class="keyword">type</span>,</span></div><div class="line">			Class&lt;?&gt;[] parameterTypes, Object... args) &#123;</div><div class="line">		ClassLoader classLoader = getClassLoader();</div><div class="line">		<span class="comment">// Use names and ensure unique to protect against duplicates</span></div><div class="line">		Set&lt;String&gt; names = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(</div><div class="line">				SpringFactoriesLoader.loadFactoryNames(<span class="class"><span class="keyword">type</span>, <span class="title">classLoader</span>));</span></div><div class="line">		List&lt;T&gt; instances = createSpringFactoriesInstances(<span class="class"><span class="keyword">type</span>, <span class="title">parameterTypes</span>,</span></div><div class="line">				classLoader, args, names);</div><div class="line">		AnnotationAwareOrderComparator.sort(instances);</div><div class="line">		<span class="keyword">return</span> instances;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Load the fully qualified class names of factory implementations of the given type from “META-INF/spring.factories”, using the given class loader.</p>
<p>使用给定的类装入器从“META-INF/spring.factories”加载给定类型的工厂实现的完全限定类名</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">public <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringFactoriesLoader</span> </span>&#123;</div><div class="line">  ...</div><div class="line"></div><div class="line">	public <span class="keyword">static</span> <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; loadFactoryNames(Class&lt;?&gt; factoryClass, <span class="meta">@Nullable</span> ClassLoader classLoader) &#123;</div><div class="line">		<span class="built_in">String</span> factoryClassName = factoryClass.getName();</div><div class="line">		<span class="keyword">return</span> loadSpringFactories(classLoader).getOrDefault(factoryClassName, Collections.emptyList());</div><div class="line">	&#125;</div><div class="line"></div><div class="line">  private <span class="keyword">static</span> <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;&gt; loadSpringFactories(<span class="meta">@Nullable</span> ClassLoader classLoader) &#123;</div><div class="line">		MultiValueMap&lt;<span class="built_in">String</span>, <span class="built_in">String</span>&gt; result = cache.<span class="keyword">get</span>(classLoader);</div><div class="line">		<span class="keyword">if</span> (result != <span class="keyword">null</span>) &#123;</div><div class="line">			<span class="keyword">return</span> result;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			Enumeration&lt;URL&gt; urls = (classLoader != <span class="keyword">null</span> ?</div><div class="line">					classLoader.getResources(FACTORIES_RESOURCE_LOCATION) :</div><div class="line">					ClassLoader.getSystemResources(FACTORIES_RESOURCE_LOCATION));</div><div class="line">			result = <span class="keyword">new</span> LinkedMultiValueMap&lt;&gt;();</div><div class="line">			<span class="keyword">while</span> (urls.hasMoreElements()) &#123;</div><div class="line">				URL url = urls.nextElement();</div><div class="line">				UrlResource resource = <span class="keyword">new</span> UrlResource(url);</div><div class="line">				Properties properties = PropertiesLoaderUtils.loadProperties(resource);</div><div class="line">				<span class="keyword">for</span> (<span class="built_in">Map</span>.Entry&lt;?, ?&gt; entry : properties.entrySet()) &#123;</div><div class="line">					<span class="built_in">String</span> factoryClassName = ((<span class="built_in">String</span>) entry.getKey()).trim();</div><div class="line">					<span class="keyword">for</span> (<span class="built_in">String</span> factoryName : StringUtils.commaDelimitedListToStringArray((<span class="built_in">String</span>) entry.getValue())) &#123;</div><div class="line">						result.add(factoryClassName, factoryName.trim());</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			cache.put(classLoader, result);</div><div class="line">			<span class="keyword">return</span> result;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">catch</span> (IOException ex) &#123;</div><div class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Unable to load factories from location ["</span> +</div><div class="line">					FACTORIES_RESOURCE_LOCATION + <span class="string">"]"</span>, ex);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>结果类型：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MultiValueMap</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">Map</span>&lt;<span class="title">K</span>, <span class="title">List</span>&lt;<span class="title">V</span>&gt;&gt; </span>&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">jar:</span><span class="string">file:</span><span class="regexp">/C:/</span>Users<span class="regexp">/boblw/</span>.gradle<span class="regexp">/caches/</span>modules<span class="number">-2</span><span class="regexp">/files-2.1/</span>org.springframework.boot<span class="regexp">/spring-boot-autoconfigure/</span><span class="number">2.1</span><span class="number">.3</span>.RELEASE<span class="regexp">/58e07f69638a3ca13dffe8a2b68d284af376d105/</span>spring-boot-autoconfigure<span class="number">-2.1</span><span class="number">.3</span>.RELEASE.jar!<span class="regexp">/META-INF/</span>spring.factories</div></pre></td></tr></table></figure>
<p>其中一个jar包中的spring.factories文件内容</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Initializers</span></div><div class="line"><span class="keyword">org.springframework.context.ApplicationContextInitializer=\</span></div><div class="line"><span class="keyword">org.springframework.boot.autoconfigure.SharedMetadataReaderFactoryContextInitializer,\</span></div><div class="line"><span class="keyword">org.springframework.boot.autoconfigure.logging.ConditionEvaluationReportLoggingListener</span></div><div class="line"></div><div class="line"><span class="comment"># Application Listeners</span></div><div class="line"><span class="keyword">org.springframework.context.ApplicationListener=\</span></div><div class="line"><span class="keyword">org.springframework.boot.autoconfigure.BackgroundPreinitializer</span></div><div class="line"></div><div class="line"><span class="comment"># Auto Configuration Import Listeners</span></div><div class="line"><span class="keyword">org.springframework.boot.autoconfigure.AutoConfigurationImportListener=\</span></div><div class="line"><span class="keyword">org.springframework.boot.autoconfigure.condition.ConditionEvaluationReportAutoConfigurationImportListener</span></div><div class="line"></div><div class="line"><span class="comment"># Auto Configuration Import Filters</span></div><div class="line"><span class="keyword">org.springframework.boot.autoconfigure.AutoConfigurationImportFilter=\</span></div><div class="line"><span class="keyword">org.springframework.boot.autoconfigure.condition.OnBeanCondition,\</span></div><div class="line">...</div><div class="line"></div><div class="line"><span class="comment"># Auto Configure</span></div><div class="line"><span class="keyword">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span></div><div class="line"><span class="keyword">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\</span></div><div class="line">...</div><div class="line"></div><div class="line"><span class="comment"># Failure analyzers</span></div><div class="line"><span class="keyword">org.springframework.boot.diagnostics.FailureAnalyzer=\</span></div><div class="line"><span class="keyword">org.springframework.boot.autoconfigure.diagnostics.analyzer.NoSuchBeanDefinitionFailureAnalyzer,\</span></div><div class="line">...</div><div class="line"></div><div class="line"><span class="comment"># Template availability providers</span></div><div class="line"><span class="keyword">org.springframework.boot.autoconfigure.template.TemplateAvailabilityProvider=\</span></div><div class="line"><span class="keyword">org.springframework.boot.autoconfigure.freemarker.FreeMarkerTemplateAvailabilityProvider,\</span></div><div class="line">...</div></pre></td></tr></table></figure>
<p>和结果类型对应起来大家就懂了吧，它会将所有jar包里的spring.factories文件内容加载合并后并缓存起来。以后通过传入class name获取到实现类并初始化。</p>
<p>SpringApplication详细构造方法中的代码片段<br>        this.mainApplicationClass = deduceMainApplicationClass();<br>从classpath中来推断出web应用类型</p>
<figure class="highlight monkey"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringApplication</span> &#123;</span></div><div class="line"></div><div class="line">  ...</div><div class="line">	<span class="keyword">private</span> <span class="class"><span class="keyword">Class</span>&lt;?&gt; <span class="title">deduceMainApplicationClass</span>() &#123;</span></div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			StackTraceElement[] stackTrace = <span class="keyword">new</span> RuntimeException().getStackTrace();</div><div class="line">			<span class="keyword">for</span> (StackTraceElement stackTraceElement : stackTrace) &#123;</div><div class="line">				<span class="keyword">if</span> (<span class="string">"main"</span>.equals(stackTraceElement.getMethodName())) &#123;</div><div class="line">					<span class="keyword">return</span> <span class="class"><span class="keyword">Class</span>.<span class="title">forName</span>(<span class="title">stackTraceElement</span>.<span class="title">getClassName</span>());</span></div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">catch</span> (ClassNotFoundException ex) &#123;</div><div class="line">			// Swallow <span class="literal">and</span> <span class="keyword">continue</span></div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="literal">null</span>;</div><div class="line">	&#125;</div><div class="line">  ...</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/spring-cloud/" rel="tag"># spring cloud</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/12/19/spring-boot-cloud-mvc/" rel="next" title="Spring boot 对于Spring MVC整合">
                <i class="fa fa-chevron-left"></i> Spring boot 对于Spring MVC整合
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">BOB</p>
              <p class="site-description motion-element" itemprop="description">3</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">87</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">28</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring-Boot应用启动流程"><span class="nav-number">1.</span> <span class="nav-text">Spring Boot应用启动流程</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BOB</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
